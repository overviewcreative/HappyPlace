!function(t){"use strict";function e(){const e=t('.acf-field[data-name="listing_photos"] .acf-repeater'),a=e.find(".acf-row").not(".acf-clone").get();a.sort(function(e,a){return(parseInt(t(e).find('input[name*="photo_order"]').val())||999)-(parseInt(t(a).find('input[name*="photo_order"]').val())||999)}),t.each(a,function(t,a){e.find(".acf-tbody").append(a)})}t(document).ready(function(){t('input[name*="price"], input[name*="square_footage"]').on("input",function(){!function(){const e=parseFloat(t('input[name*="price"]').val())||0,a=parseFloat(t('input[name*="square_footage"]').val())||0;if(e>0&&a>0){const n=(e/a).toFixed(2);t('input[name*="price_per_sqft"]').val(n).addClass("calculated-updated")}}()}),t('input[name*="bathrooms"], input[name*="half_bathrooms"]').on("input",function(){!function(){const e=parseFloat(t('input[name*="bathrooms"]:not([name*="half"]):not([name*="total"])').val())||0,a=parseFloat(t('input[name*="half_bathrooms"]').val())||0,n=e+.5*a;t('input[name*="bathrooms_total"]').val(n.toFixed(1)).addClass("calculated-updated")}()}),t('input[name*="annual_taxes"]').on("input",function(){!function(){const e=parseFloat(t('input[name*="annual_taxes"]').val())||0;if(e>0){const a=(e/12).toFixed(2);t('input[name*="estimated_monthly_taxes"]').val(a).addClass("calculated-updated")}}()}),t('input[name*="price"], input[name*="estimated_down_payment"], input[name*="interest_rate"]').on("input",function(){!function(){const e=parseFloat(t('input[name*="price"]').val())||0,a=parseFloat(t('input[name*="estimated_down_payment"]').val())||20,n=parseFloat(t('input[name*="interest_rate"]').val())||7,o=parseInt(t('select[name*="loan_term"]').val())||30;if(e>0){const i=e*(a/100);t('input[name*="estimated_down_payment_amount"]').val(i.toFixed(2)).addClass("calculated-updated");const l=e-i;if(t('input[name*="estimated_loan_amount"]').val(l.toFixed(2)).addClass("calculated-updated"),l>0&&n>0){const e=n/100/12,a=12*o,i=l*(e*Math.pow(1+e,a))/(Math.pow(1+e,a)-1);t('input[name*="estimated_monthly_payment"]').val(i.toFixed(2)).addClass("calculated-updated")}}}()}),t('input[name*="estimated_monthly_rent"], input[name*="price"]').on("input",function(){!function(){const e=parseFloat(t('input[name*="price"]').val())||0,a=parseFloat(t('input[name*="estimated_monthly_rent"]').val())||0;if(e>0&&a>0){const n=12*a;t('input[name*="estimated_annual_rent"]').val(n.toFixed(2)).addClass("calculated-updated");const o=n/e*100;t('input[name*="gross_rental_yield"]').val(o.toFixed(2)).addClass("calculated-updated");const i=a/e*100;t('input[name*="one_percent_rule_ratio"]').val(i.toFixed(2)).addClass("calculated-updated")}}()}),t('input[name*="listing_date"]').on("change",function(){!function(){const e=t('input[name*="listing_date"]').val();if(e){const a=new Date(e),n=(new Date).getTime()-a.getTime(),o=Math.ceil(n/864e5);t('input[name*="days_on_market"]').val(Math.max(0,o)).addClass("calculated-updated")}}()}),t('input[name*="estimated_monthly_payment"], input[name*="estimated_monthly_taxes"], input[name*="estimated_monthly_insurance"], input[name*="hoa_fee"]').on("input",function(){!function(){const e=parseFloat(t('input[name*="estimated_monthly_payment"]').val())||0,a=parseFloat(t('input[name*="estimated_monthly_taxes"]').val())||0,n=parseFloat(t('input[name*="estimated_monthly_insurance"]').val())||0,o=parseFloat(t('input[name*="hoa_fee"]').val())||0,i=e+a+n+o;t('input[name*="total_monthly_cost"]').val(i.toFixed(2)).addClass("calculated-updated")}()}),t(".calculated-updated").each(function(){t(this).addClass("success"),setTimeout(()=>{t(this).removeClass("success calculated-updated")},2e3)}),t(".hph-calculated-field input, .hph-calculated-field textarea, .hph-calculated-field select").attr("readonly",!0),t(".hph-auto-populated input, .hph-auto-populated textarea, .hph-auto-populated select").attr("readonly",!0),t('textarea[name*="listing_description_short"]').on("input",function(){const e=250-t(this).val().length;let a=t(this).siblings(".char-counter");0===a.length&&(a=t('<div class="char-counter"></div>'),t(this).after(a)),a.text(e+" characters remaining"),a.toggleClass("over-limit",e<0)}),t(document).on("change",'input[name*="photo_order"]',function(){e()}),t(document).on("change",'input[name*="photo_featured"]',function(){t(this).is(":checked")&&(t('input[name*="photo_featured"]').not(this).prop("checked",!1),t(this).closest(".acf-row").find('input[name*="photo_order"]').val(1),e())}),t(document).on("change",'select[name*="photo_room_type"]',function(){const e=t(this).val(),a=t(this).closest(".acf-row");a.removeClass(function(t,e){return(e.match(/(^|\s)room-type-\S+/g)||[]).join(" ")}),e&&a.addClass("room-type-"+e)}),t('select[name*="custom_features"]').select2({tags:!0,tokenSeparators:[","],placeholder:"Select or type custom features...",allowClear:!0,createTag:function(e){const a=t.trim(e.term);return""===a?null:{id:a.toLowerCase().replace(/\s+/g,"_"),text:a,newTag:!0}}}),t('select[name*="custom_features"]').on("select2:select",function(t){t.params.data.newTag&&console.log("New feature added:",t.params.data.text)})}),t(document).on("change",'select[name*="community"]',function(){const e=t(this).val();e&&"undefined"!=typeof hphCalc&&t.ajax({url:hphCalc.ajaxurl,type:"POST",data:{action:"hph_get_community_hoa_data",community_id:e,nonce:hphCalc.nonce},success:function(e){if(e.success&&e.data){let a=0;switch(t('select[name*="property_type"]').val()){case"Single Family Home":a=e.data.hoa_fee_single_family||0;break;case"Townhouse":a=e.data.hoa_fee_townhouse||0;break;case"Condo":a=e.data.hoa_fee_condo||0}a>0&&t('input[name*="hoa_fee"]').val(a).addClass("auto-populated"),function(e,a="info"){const n=t('<div class="notice notice-'+a+' is-dismissible"><p>'+e+"</p></div>");t(".wrap h1").after(n),setTimeout(function(){n.fadeOut()},5e3)}("HOA information auto-populated from community data","success")}}})});const a=t("<style>").text("\n        .char-counter {\n            font-size: 12px;\n            color: #666;\n            margin-top: 5px;\n        }\n        .char-counter.over-limit {\n            color: #dc3232;\n            font-weight: bold;\n        }\n        .calculated-updated {\n            background-color: #f0fff4 !important;\n            border-color: #46b450 !important;\n        }\n        .auto-populated {\n            background-color: #f0f8ff !important;\n            border-color: #0073aa !important;\n        }\n        .room-type-exterior { border-left: 4px solid #2ecc71; }\n        .room-type-kitchen { border-left: 4px solid #e74c3c; }\n        .room-type-living_room { border-left: 4px solid #3498db; }\n        .room-type-master_bedroom { border-left: 4px solid #9b59b6; }\n        .room-type-bathroom { border-left: 4px solid #1abc9c; }\n        .room-type-pool { border-left: 4px solid #00bcd4; }\n    ");t("head").append(a)}(jQuery);