!function(t){"use strict";var e={init:function(){this.bindEvents()},bindEvents:function(){t("#hph-test-airtable").on("click",this.testAirtableConnection),t("#hph-manual-sync").on("click",this.triggerManualSync),t("#hph-integrations-form").on("submit",this.saveSettings)},testAirtableConnection:function(n){n.preventDefault();var s=t(this),a=t("#hph-test-result"),r=t("#airtable_access_token").val(),i=t("#airtable_base_id").val(),o=t("#airtable_table_name").val();r&&i?(s.prop("disabled",!0).text(hphIntegrations.strings.testing),a.hide(),t.ajax({url:hphIntegrations.ajaxurl,type:"POST",data:{action:"hph_test_airtable_connection",nonce:hphIntegrations.nonce,access_token:r,base_id:i,table_name:o},success:function(t){t.success?e.showResult(a,"success",t.data):e.showResult(a,"error",hphIntegrations.strings.error+" "+t.data)},error:function(){e.showResult(a,"error","Connection failed due to network error")},complete:function(){s.prop("disabled",!1).text("Test Connection")}})):e.showResult(a,"error","Personal Access Token and Base ID are required")},triggerManualSync:function(e){e.preventDefault();var n=t(this),s=t("#hph-sync-progress"),a=t("#hph-sync-status"),r=t(".hph-progress-fill");n.prop("disabled",!0).text(hphIntegrations.strings.syncing),s.show(),r.css("width","10%"),a.text("Initializing sync...");var i=[{progress:25,text:"Fetching Airtable records..."},{progress:50,text:"Processing data..."},{progress:75,text:"Updating WordPress posts..."},{progress:90,text:"Finalizing sync..."}],o=0,c=setInterval(function(){if(o<i.length){var t=i[o];r.css("width",t.progress+"%"),a.text(t.text),o++}else clearInterval(c)},1e3);t.ajax({url:hphIntegrations.ajaxurl,type:"POST",data:{action:"hph_trigger_manual_sync",nonce:hphIntegrations.nonce},success:function(t){if(clearInterval(c),r.css("width","100%"),t.success){a.text(hphIntegrations.strings.sync_complete);var e=t.data,n="Sync completed: ";e.airtable_to_wp&&(n+=e.airtable_to_wp.created+" created, "+e.airtable_to_wp.updated+" updated from Airtable. "),e.wp_to_airtable&&(n+=e.wp_to_airtable.created+" created, "+e.wp_to_airtable.updated+" updated to Airtable."),setTimeout(function(){a.text(n)},1e3),setTimeout(function(){s.fadeOut()},3e3)}else a.text(hphIntegrations.strings.sync_error+" "+t.data),r.css("background","#dc3545")},error:function(){clearInterval(c),a.text("Sync failed due to network error"),r.css("background","#dc3545")},complete:function(){n.prop("disabled",!1).text("Manual Sync")}})},saveSettings:function(e){var n=t(this).find('input[type="submit"]');n.val("Saving..."),setTimeout(function(){n.val("Save Integration Settings")},2e3)},showResult:function(t,e,n){t.removeClass("hph-test-success hph-test-error").addClass("hph-test-"+e).text(n).show()}};t(document).ready(function(){e.init()})}(jQuery);