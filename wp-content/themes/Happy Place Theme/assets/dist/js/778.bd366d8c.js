(self.webpackChunkhappy_place_theme=self.webpackChunkhappy_place_theme||[]).push([[778],{778:function(){!function(e,t){"use strict";const i={init:function(){this.navItems=t.querySelectorAll(".hph-dashboard-nav-item"),this.sections=t.querySelectorAll(".hph-dashboard-section"),this.currentSection=this.getCurrentSection(),this.bindEvents(),this.showSection(this.currentSection)},bindEvents:function(){this.navItems.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const i=e.dataset.section;this.switchToSection(i)})}),e.addEventListener("popstate",e=>{e.state&&e.state.section&&this.showSection(e.state.section,!1)})},getCurrentSection:function(){return new URLSearchParams(e.location.search).get("section")||"overview"},switchToSection:function(e){if(e===this.currentSection)return;const t=this.updateURL(e);history.pushState({section:e},"",t),this.showSection(e)},showSection:function(e,i=!0){i&&this.updateNavigation(e),this.sections.forEach(e=>{e.classList.remove("hph-dashboard-section--active")});const s=t.getElementById(e);if(s){const t="true"===s.dataset.loaded,i="true"===s.dataset.needsRefresh,a=""!==s.innerHTML.trim();t||a&&!i?(s.classList.add("hph-dashboard-section--active"),a&&(s.dataset.loaded="true")):this.loadSectionContent(e,s)}this.currentSection=e;const o=t.querySelector(".hph-mobile-title");if(o){const i=t.querySelector(`[data-section="${e}"]`);o.textContent=i?i.querySelector("span").textContent:"Dashboard"}a.closeMobileMenu()},updateNavigation:function(e){this.navItems.forEach(t=>{t.dataset.section===e?(t.classList.add("hph-dashboard-nav-item--active"),t.setAttribute("aria-current","page")):(t.classList.remove("hph-dashboard-nav-item--active"),t.setAttribute("aria-current","false"))})},loadSectionContent:function(t,i){i.classList.add("hph-dashboard-section--loading"),i.classList.add("hph-dashboard-section--active"),fetch(e.hphAjax.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"hph_load_dashboard_section",section:t,nonce:e.hphAjax.nonce})}).then(e=>e.json()).then(e=>{e.success?(i.innerHTML=e.data.content,i.classList.remove("hph-dashboard-section--loading"),this.initSectionFeatures(t),a.trigger("section:loaded",{section:t})):this.showSectionError(i)}).catch(e=>{console.error("Dashboard section load error:",e),this.showSectionError(i)})},showSectionError:function(e){e.innerHTML='\n                <div class="hph-empty-state">\n                    <div class="hph-empty-state-icon">\n                        <i class="fas fa-exclamation-triangle"></i>\n                    </div>\n                    <h2 class="hph-empty-state-title">Error Loading Section</h2>\n                    <p class="hph-empty-state-description">\n                        There was an error loading this section. Please try refreshing the page.\n                    </p>\n                    <button class="hph-btn hph-btn--primary" onclick="window.location.reload()">\n                        <i class="fas fa-sync"></i> Refresh Page\n                    </button>\n                </div>\n            ',e.classList.remove("hph-dashboard-section--loading")},initSectionFeatures:function(e){a["init"+e.charAt(0).toUpperCase()+e.slice(1)+"Features"]&&a["init"+e.charAt(0).toUpperCase()+e.slice(1)+"Features"]()},updateURL:function(t){const i=new URL(e.location);return i.searchParams.set("section",t),i.toString()}},a={config:{ajaxUrl:e.hphAjax?.ajaxUrl||"/wp-admin/admin-ajax.php",nonce:e.hphAjax?.nonce||"",debug:e.hphAjax?.debug||!1,autoSaveInterval:3e4,notificationDuration:5e3,chartColors:{primary:"#51bae0",primaryGradient:["#51bae0","#38bdf8"],success:"#059669",warning:"#d97706",danger:"#dc2626",gray:"#6b7280"}},state:{currentSection:"overview",isMobile:e.innerWidth<=768,isLoading:!1,activeModals:new Set,autoSaveTimer:null,notificationTimer:null},cache:{body:null,dashboard:null,sidebar:null,mainContent:null,navItems:null,sections:null,modals:null,toastContainer:null},init(){this.log("Initializing Dashboard..."),this.cacheElements(),this.initNavigation(),this.initMobileFeatures(),this.initModals(),this.initForms(),this.initTooltips(),this.initCharts(),this.initRealTimeFeatures(),this.initKeyboardShortcuts(),this.bindEvents(),this.initSectionFeatures(),this.hideLoadingOverlay(),this.log("Dashboard initialized successfully"),this.trigger("dashboard:initialized")},cacheElements(){this.cache.body=t.body,this.cache.dashboard=t.querySelector(".hph-dashboard"),this.cache.sidebar=t.querySelector(".hph-dashboard-sidebar"),this.cache.mainContent=t.querySelector(".hph-dashboard-main"),this.cache.navItems=t.querySelectorAll(".hph-dashboard-nav-item"),this.cache.sections=t.querySelectorAll(".hph-dashboard-section"),this.cache.modals=t.querySelectorAll(".hph-modal-overlay"),this.cache.toastContainer=t.getElementById("hph-toast-container")},initNavigation(){this.cache.navItems.forEach(t=>{t.addEventListener("click",i=>{const a=t.dataset.section;e.hphAjaxEnabled&&a&&(i.preventDefault(),this.loadSection(a))})})},initMobileFeatures(){const i=t.querySelector(".hph-mobile-menu-btn"),a=t.querySelector(".hph-mobile-overlay");i&&this.cache.sidebar&&a&&(i.addEventListener("click",()=>{this.toggleMobileMenu()}),a.addEventListener("click",()=>{this.closeMobileMenu()}),t.addEventListener("keydown",e=>{"Escape"===e.key&&this.isMobileMenuOpen()&&this.closeMobileMenu()})),e.addEventListener("resize",()=>{const t=this.state.isMobile;this.state.isMobile=e.innerWidth<=768,t!==this.state.isMobile&&this.handleResponsiveChange()})},initModals(){t.addEventListener("click",e=>{const t=e.target.closest("[data-modal]");if(t){e.preventDefault();const i=t.dataset.modal;this.openModal(i)}}),t.addEventListener("click",e=>{const t=e.target.closest('[data-dismiss="modal"]');if(t){const e=t.closest(".hph-modal-overlay");e&&this.closeModal(e.id)}}),this.cache.modals.forEach(e=>{e.addEventListener("click",t=>{t.target===e&&this.closeModal(e.id)})}),t.addEventListener("keydown",e=>{"Escape"===e.key&&this.state.activeModals.size>0&&this.closeTopModal()})},initForms(){t.addEventListener("submit",e=>{const t=e.target;(t.classList.contains("hph-dashboard-form")||t.closest(".hph-modal"))&&(this.validateForm(t)||(e.preventDefault(),this.showToast("Please fix the errors and try again.","error")))}),this.initAutoSave(),this.initFileUploads(),this.initRealTimeValidation()},initTooltips(){t.querySelectorAll("[title]").forEach(e=>{})},initCharts(){"undefined"!=typeof Chart&&(this.initPerformanceCharts(),this.initLeadCharts()),this.initProgressBars(),this.initCounters()},initRealTimeFeatures(){this.initLiveTime(),e.WebSocket&&this.initWebSocketConnection(),this.initPeriodicRefresh()},initKeyboardShortcuts(){t.addEventListener("keydown",e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"true"!==e.target.contentEditable){if(e.ctrlKey||e.metaKey)switch(e.key){case"s":e.preventDefault(),this.saveCurrentForm();break;case"k":e.preventDefault(),this.focusSearch()}if(e.key>="1"&&e.key<="9"&&!e.ctrlKey&&!e.metaKey){const t=parseInt(e.key)-1,i=this.cache.navItems[t];i&&i.click()}}})},bindEvents(){t.addEventListener("click",e=>{const t=e.target.closest(".hph-view-btn");t&&this.handleViewToggle(t)}),t.addEventListener("click",e=>{const t=e.target.closest(".hph-dropdown-toggle");t&&(e.preventDefault(),e.stopPropagation(),this.toggleDropdown(t.closest(".hph-dropdown")))}),t.addEventListener("click",()=>{this.closeAllDropdowns()}),t.addEventListener("click",e=>{const t=e.target.closest(".hph-view-tab");t&&this.handleTabSwitch(t)}),t.addEventListener("click",e=>{const t=e.target.closest("[data-action]");t&&this.handleQuickAction(t)})},initSectionFeatures(){this.initOverviewFeatures(),this.initListingsFeatures(),this.initPerformanceFeatures(),this.initOpenHousesFeatures(),this.initLeadsFeatures(),this.initProfileFeatures()},loadSection(e){if(this.state.isLoading)return;this.state.isLoading=!0,this.showLoadingOverlay(`Loading ${e}...`);const t={action:"hph_load_dashboard_section",section:e,nonce:this.config.nonce};fetch(this.config.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)}).then(e=>e.json()).then(t=>{t.success?(this.updateSection(e,t.data.html),this.updateNavigation(e),this.state.currentSection=e,history.pushState({section:e},"",`?section=${e}`),this.trigger("section:loaded",{section:e})):this.showToast("Error loading section. Please try again.","error")}).catch(e=>{this.log("AJAX Error:",e),this.showToast("Connection error. Please check your internet connection.","error")}).finally(()=>{this.state.isLoading=!1,this.hideLoadingOverlay()})},toggleMobileMenu(){this.isMobileMenuOpen()?this.closeMobileMenu():this.openMobileMenu()},openMobileMenu(){this.cache.sidebar.classList.add("hph-dashboard-sidebar--open"),t.querySelector(".hph-mobile-overlay").classList.add("hph-mobile-overlay--active"),this.cache.body.classList.add("hph-modal-open")},closeMobileMenu(){this.cache.sidebar.classList.remove("hph-dashboard-sidebar--open"),t.querySelector(".hph-mobile-overlay").classList.remove("hph-mobile-overlay--active"),this.cache.body.classList.remove("hph-modal-open")},isMobileMenuOpen(){return this.cache.sidebar.classList.contains("hph-dashboard-sidebar--open")},openModal(e){const i=t.getElementById(e+"-modal")||t.getElementById(e);if(!i)return void this.log("Modal not found:",e);i.classList.add("hph-modal-overlay--active"),this.cache.body.classList.add("hph-modal-open"),this.state.activeModals.add(e);const a=i.querySelector("input, textarea, select, button");a&&setTimeout(()=>a.focus(),100),this.trigger("modal:opened",{modalId:e})},closeModal(e){const i=t.getElementById(e+"-modal")||t.getElementById(e);i&&(i.classList.remove("hph-modal-overlay--active"),this.state.activeModals.delete(e),0===this.state.activeModals.size&&this.cache.body.classList.remove("hph-modal-open"),this.trigger("modal:closed",{modalId:e}))},closeTopModal(){if(this.state.activeModals.size>0){const e=Array.from(this.state.activeModals);this.closeModal(e[e.length-1])}},showToast(e,t="info",i=null){this.cache.toastContainer||this.createToastContainer();const a=this.createToastElement(e,t);this.cache.toastContainer.appendChild(a),setTimeout(()=>{a.classList.add("hph-toast--entering"),a.classList.add("hph-toast--entered")},10);const s=i||this.config.notificationDuration;return setTimeout(()=>{this.removeToast(a)},s),a},createToastContainer(){this.cache.toastContainer||(this.cache.toastContainer=t.createElement("div"),this.cache.toastContainer.id="hph-toast-container",this.cache.toastContainer.className="hph-toast-container",t.body.appendChild(this.cache.toastContainer))},createToastElement(e,i){const a=t.createElement("div");a.className=`hph-toast hph-toast--${i}`;const s={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};a.innerHTML=`\n                <div class="hph-toast-icon">\n                    <i class="fas ${s[i]||s.info}"></i>\n                </div>\n                <div class="hph-toast-content">\n                    <div class="hph-toast-message">${e}</div>\n                </div>\n                <button class="hph-toast-close" aria-label="Close notification">\n                    <i class="fas fa-times"></i>\n                </button>\n            `;return a.querySelector(".hph-toast-close").addEventListener("click",()=>{this.removeToast(a)}),a},removeToast(e){e.classList.add("hph-toast--exiting"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)},validateForm(e){let t=!0;return e.querySelectorAll("[required]").forEach(e=>{this.validateField(e)||(t=!1)}),t},validateField(e){const t=e.value.trim(),i=e.type;let a=!0;if(e.classList.remove("hph-form-input--error"),this.removeFieldError(e),e.required&&!t&&(a=!1,this.addFieldError(e,"This field is required.")),t&&a)switch(i){case"email":this.isValidEmail(t)||(a=!1,this.addFieldError(e,"Please enter a valid email address."));break;case"tel":this.isValidPhone(t)||(a=!1,this.addFieldError(e,"Please enter a valid phone number."));break;case"url":this.isValidUrl(t)||(a=!1,this.addFieldError(e,"Please enter a valid URL."))}return a||e.classList.add("hph-form-input--error"),a},addFieldError(e,i){const a=t.createElement("div");a.className="hph-form-error",a.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${i}`,e.parentNode.appendChild(a)},removeFieldError(e){const t=e.parentNode.querySelector(".hph-form-error");t&&t.remove()},initAutoSave(){t.querySelectorAll(".hph-dashboard-form[data-auto-save]").forEach(e=>{e.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("input",()=>{this.scheduleAutoSave(e)})})})},scheduleAutoSave(e){this.state.autoSaveTimer&&clearTimeout(this.state.autoSaveTimer),this.state.autoSaveTimer=setTimeout(()=>{this.performAutoSave(e)},this.config.autoSaveInterval)},performAutoSave(e){const t=new FormData(e);t.append("action","hph_auto_save"),t.append("nonce",this.config.nonce),fetch(this.config.ajaxUrl,{method:"POST",body:t}).then(e=>e.json()).then(e=>{e.success&&this.showAutoSaveIndicator()}).catch(e=>{this.log("Auto-save error:",e)})},showAutoSaveIndicator(){const e=t.querySelector(".hph-auto-save-indicator");e&&(e.textContent="Draft saved",e.classList.add("hph-auto-save-indicator--visible"),setTimeout(()=>{e.classList.remove("hph-auto-save-indicator--visible")},2e3))},initFileUploads(){t.querySelectorAll('input[type="file"]').forEach(e=>{e.addEventListener("change",e=>{this.handleFileUpload(e.target)})});t.querySelectorAll(".hph-file-upload").forEach(e=>{e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("hph-file-upload--dragover")}),e.addEventListener("dragleave",()=>{e.classList.remove("hph-file-upload--dragover")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("hph-file-upload--dragover");const i=t.dataTransfer.files,a=e.querySelector('input[type="file"]');a&&i.length>0&&(a.files=i,this.handleFileUpload(a))})})},handleFileUpload(e){const t=e.files,i=e.closest(".hph-file-upload").querySelector(".hph-file-preview");i&&this.createFilePreviews(t,i),e.dataset.preview&&this.handleAvatarPreview(e,e.dataset.preview)},createFilePreviews(e,i){i.innerHTML="",Array.from(e).forEach(e=>{if(e.type.startsWith("image/")){const a=new FileReader;a.onload=a=>{const s=t.createElement("div");s.className="hph-file-preview-item",s.innerHTML=`\n                            <img src="${a.target.result}" class="hph-file-preview-image" alt="${e.name}">\n                            <button type="button" class="hph-file-preview-remove" onclick="this.parentNode.remove()">\n                                <i class="fas fa-times"></i>\n                            </button>\n                        `,i.appendChild(s)},a.readAsDataURL(e)}})},handleAvatarPreview(e,i){const a=e.files[0],s=t.getElementById(i);if(a&&s){const e=new FileReader;e.onload=e=>{if("IMG"===s.tagName)s.src=e.target.result;else{const i=t.createElement("img");i.src=e.target.result,i.className=s.className,i.id=s.id,s.parentNode.replaceChild(i,s)}},e.readAsDataURL(a)}},initRealTimeValidation(){t.querySelectorAll(".hph-form-input, .hph-form-textarea, .hph-form-select").forEach(e=>{e.addEventListener("blur",()=>{e.value.trim()&&this.validateField(e)}),e.addEventListener("input",()=>{e.classList.contains("hph-form-input--error")&&this.validateField(e)})})},initLiveTime(){const e=t.querySelectorAll('[data-live-time="true"]');e.length>0&&setInterval(()=>{const t=(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});e.forEach(e=>{e.textContent=t})},6e4)},initPerformanceCharts(){const e=t.getElementById("hph-views-chart");if(!e)return;const i=e.parentNode.querySelector(".hph-chart-placeholder");i&&(i.style.display="none");const a=e.getContext("2d");new Chart(a,{type:"line",data:{labels:this.generateDateLabels(30),datasets:[{label:"Views",data:this.generateSampleData(30,10,100),borderColor:this.config.chartColors.primary,backgroundColor:this.config.chartColors.primary+"20",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"#f3f4f6"}},x:{grid:{color:"#f3f4f6"}}}}})},initProgressBars(){const e=t.querySelectorAll(".hph-progress-fill"),i=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,a=t.style.width;t.style.width="0%",setTimeout(()=>{t.style.width=a},100),i.unobserve(t)}})});e.forEach(e=>i.observe(e))},initCounters(){const e=t.querySelectorAll(".hph-stat-value, .hph-metric-value"),i=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.animateCounter(e.target),i.unobserve(e.target))})});e.forEach(e=>i.observe(e))},animateCounter(e){const t=e.textContent.trim(),i=parseInt(t.replace(/[^\d]/g,""));if(isNaN(i))return;const a=i/20;let s=0;const o=setInterval(()=>{s+=a,s>=i&&(s=i,clearInterval(o)),e.textContent=t.replace(i.toString(),Math.floor(s).toLocaleString())},50)},initOverviewFeatures(){t.querySelectorAll(".hph-quick-action").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault()})})},initListingsFeatures(){this.initViewToggles(),this.initListingActions()},initPerformanceFeatures(){t.querySelectorAll(".hph-period-btn").forEach(e=>{e.addEventListener("click",()=>{this.updateChartPeriod(e.dataset.period)})})},initOpenHousesFeatures(){this.initCalendar()},initLeadsFeatures(){this.initLeadActions()},initProfileFeatures(){this.initProfileActions()},handleFormSubmit(t){if(!t)return;const i=new FormData(t),a=t.querySelector('button[type="submit"]'),s=a?a.innerHTML:"";a&&(a.innerHTML='<i class="fas fa-spinner fa-spin"></i> Saving...',a.disabled=!0),fetch(this.config.ajaxUrl,{method:"POST",body:i}).then(e=>e.json()).then(i=>{i.success?(this.showToast(i.data.message||"Saved successfully!","success"),i.data.redirect&&(e.location.href=i.data.redirect),this.trigger("form:submitted",{form:t,data:i})):this.showToast(i.data.message||"Error saving form.","error")}).catch(e=>{console.error("Form submission error:",e),this.showToast("Failed to save. Please try again.","error")}).finally(()=>{a&&(a.innerHTML=s,a.disabled=!1)})},generateDateLabels(e){const t=[];for(let i=e-1;i>=0;i--){const e=new Date;e.setDate(e.getDate()-i),t.push(e.toLocaleDateString("en-US",{month:"short",day:"numeric"}))}return t},generateSampleData(e,t,i){return Array.from({length:e},()=>Math.floor(Math.random()*(i-t+1))+t)},isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},isValidPhone(e){return/^[\+]?[1-9][\d]{0,15}$/.test(e.replace(/\D/g,""))},isValidUrl(e){try{return new URL(e),!0}catch{return!1}},log(...e){this.config.debug&&console.log("[HPH Dashboard]",...e)},trigger(e,i={}){const a=new CustomEvent(e,{detail:i});t.dispatchEvent(a)},showLoadingOverlay(e="Loading..."){const i=t.getElementById("hph-loading-overlay");i&&(i.querySelector(".hph-loading-message").textContent=e,i.classList.add("hph-loading-overlay--active"))},hideLoadingOverlay(){const e=t.getElementById("hph-loading-overlay");e&&e.classList.remove("hph-loading-overlay--active")},handleResponsiveChange(){!this.state.isMobile&&this.isMobileMenuOpen()&&this.closeMobileMenu(),this.log(`Responsive change: ${this.state.isMobile?"Mobile":"Desktop"} mode`),this.trigger("responsive:changed",{isMobile:this.state.isMobile,breakpoint:this.state.isMobile?"mobile":"desktop"})}};"loading"===t.readyState?t.addEventListener("DOMContentLoaded",()=>{a.init(),i.init()}):(a.init(),i.init()),e.HphDashboard=a,e.DashboardTabs=i}(window,document)}}]);